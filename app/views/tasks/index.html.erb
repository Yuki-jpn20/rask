<div class="flex mt-10">
  <%= render 'layouts/h1', title: "タスク一覧" %>
  <div class="flex-1"></div>
  <div class="p-3 my-3 border rounded flex space-x-4">
  <!--検索フォーム-->
  <%= search_form_for @q do |f| %>
    <%= f.text_field :content_or_assigner_screen_name_or_description_or_project_name_cont, placeholder: '検索ワードを入力して下さい' %>
    <%= f.submit "検索" %>
  <% end %>
  </div>
  <%= link_to '新規作成', new_task_path, class: "my-auto text-white bg-red-400 rounded p-2" %>
</div>

<% @tasks.each do |task| %>
  <div class="p-3 my-3 border rounded flex space-x-4">
    <div>
      <p class="text-xl">
        <% if task.state.name=="todo" %>
          <i id="task_<%= task.id %>" class="far fa-dot-circle"></i>
        <% elsif task.state.name=="done" %>
          <i id="task_<%= task.id %>" class="far fa-check-circle"></i>
        <% elsif task.state.name="draft" %>
          <i id="task_<%= task.id %>" class="far fa-circle"></i>
        <% end %>
        <%= link_to task.content, task %>
      </p>
      <p>
      <% if task.project %>
        <%= link_to task.project.name, task.project %>
      <% end %>
      <%= link_to task.assigner.name, task.assigner %>
      <%= task.show_days_ago.round.to_s + "日前" %>
      <% task.tags.each do |tag| %>
        <%= link_to tag_label(tag), tag %>
      <% end %>
      </p>
    </div>
    <div class="flex-1">
      <% if task.overdue? %>
        <p class="overdue_mark">期限切れです！</p>
      <% else %>
        <p class="ongoing_mark"><%= days_to_deadline_as_string task %></p>
      <% end %>
    </div>
    <% if logged_in? %>
      <%= link_to '詳細', task %>
      <%= link_to '編集', edit_task_path(task) %>
      <%= link_to '削除', task, method: :delete, data: { confirm: 'このタスクを削除しますか？' } %>
      <%= link_to '完了', complete_path(task, task_state_name: "done"), method: :put, onclick: "updateState(#{task.id})" %>
    <% end %>
  </div>
<% end %>

<div class="row">
  <div class="col-md-12 col-sm-12 text-center hidden-xs">
    <%= raw(paginate @tasks) %>
  </div>
</div>

<script>
  function updateState(task_id){
    id = "task_" + task_id;
    element = document.getElementById(id);
    element.classList.toggle('fa-check-circle');
  }
</script>
